<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EvoPhylo">
<title>Evolutionary Rates &amp; Selection Mode (BEAST2) • EvoPhylo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evolutionary Rates &amp; Selection Mode (BEAST2)">
<meta property="og:description" content="EvoPhylo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EvoPhylo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_treatment.html">Theoretical background</a>
    <a class="dropdown-item" href="../articles/char-part.html">Character Partitioning</a>
    <a class="dropdown-item" href="../articles/rates-selection_MrBayes.html">Evolutionary Rates &amp; Selection Mode (Mr.Bayes)</a>
    <a class="dropdown-item" href="../articles/rates-selection_BEAST2.html">Evolutionary Rates &amp; Selection Mode (BEAST2)</a>
    <a class="dropdown-item" href="../articles/fbd-params.html">Analyzing FBD Parameters</a>
    <a class="dropdown-item" href="../articles/offset_handling.html">Analyzing Trees With Offsets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tiago-simoes/EvoPhylo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="rates-selection_BEAST2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="rates-selection_BEAST2_files/kePrint-0.0.1/kePrint.js"></script><link href="rates-selection_BEAST2_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Evolutionary Rates &amp; Selection Mode (BEAST2)</h1>
            
            <h4 data-toc-skip class="date">2022-11-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tiago-simoes/EvoPhylo/blob/HEAD/vignettes/rates-selection_BEAST2.Rmd" class="external-link"><code>vignettes/rates-selection_BEAST2.Rmd</code></a></small>
      <div class="d-none name"><code>rates-selection_BEAST2.Rmd</code></div>
    </div>

    
    
<p>This vignette explains how to extract evolutionary rate parameters estimated from relaxed clock Bayesian inference analyses produced by <a href="https://www.beast2.org/" class="external-link">BEAST2</a>. It also shows how to use evolutionary rate based inference of selection mode (strength) adapted to clock-based rates, as introduced by <span class="citation">Simões and Pierce (<a href="#ref-sim%C3%B5es2021" role="doc-biblioref">2021</a>)</span>. See the sister vignette “Evolutionary Rates &amp; Selection Mode (BEAST2)” for an equivalent workflow using output data produced by <a href="https://nbisweden.github.io/MrBayes/" class="external-link">Mr. Bayes</a>.</p>
<p>Load the <strong>EvoPhylo</strong> package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tiago-simoes/EvoPhylo" class="external-link">EvoPhylo</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="evolutionary-rates-statistics-and-plots">Evolutionary Rates Statistics and Plots<a class="anchor" aria-label="anchor" href="#evolutionary-rates-statistics-and-plots"></a>
</h2>
<p>In this section, we will extract evolutionary rate parameters from each node from a Bayesian clock (time-calibrated) summary tree. The functions below will store them in a data frame, produce summary statistics tables, and create different plots showing how rates are distributed across morphological partitions and clades. Note that step 0 needs to be performed <em>before</em> running the inference when using <a href="https://www.beast2.org/" class="external-link">BEAST2</a>.</p>
<p> </p>
<div class="section level3">
<h3 id="set-your-beast2-analysis-to-log-multiple-clocks">0. Set your <a href="https://www.beast2.org/" class="external-link">BEAST2</a> analysis to log multiple clocks<a class="anchor" aria-label="anchor" href="#set-your-beast2-analysis-to-log-multiple-clocks"></a>
</h3>
<p>This step is specific to <a href="https://www.beast2.org/" class="external-link">BEAST2</a> analyses - if using <a href="https://nbisweden.github.io/MrBayes/" class="external-link">Mr. Bayes</a>, skip directly to step 1.</p>
<p>When using a default configuration generated through BEAUti, only one of the clocks will be logged along the tree. For the other clocks, only summary statistics (such as the mean rate) will be logged. In order to obtain the clock rates for different partitions, we need to modify the setup <em>before</em> running the inference.</p>
<p>In order to do this, open the <a href="https://www.beast2.org/" class="external-link">BEAST2</a> XML configuration file and find the section which logs the tree, which should look similar to this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">&lt;logger</span><span class="ot"> id=</span><span class="st">"treelog.t:26"</span><span class="ot"> spec=</span><span class="st">"Logger"</span><span class="ot"> fileName=</span><span class="st">"multiclock.trees"</span><span class="ot"> logEvery=</span><span class="st">"10"</span><span class="ot"> mode=</span><span class="st">"tree"</span><span class="kw">&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="kw">&lt;log</span><span class="ot"> id=</span><span class="st">"TreeWithMetaDataLogger.t:26"</span><span class="ot"> spec=</span><span class="st">"beast.evolution.tree.TreeWithMetaDataLogger"</span><span class="ot"> branchratemodel=</span><span class="st">"@RelaxedClock.c:26"</span><span class="ot"> tree=</span><span class="st">"@Tree.t:26"</span><span class="kw">/&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">&lt;/logger&gt;</span></span></code></pre></div>
<p>This section needs to be <em>duplicated</em> for each additional clock, modifying the name of the clock (<code>branchratemodel</code>), the file name (<code>fileName</code>) and the name of the logger (<code>id</code>) like in this example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">&lt;logger</span><span class="ot"> id=</span><span class="st">"treelog.t:26.2"</span><span class="ot"> spec=</span><span class="st">"Logger"</span><span class="ot"> fileName=</span><span class="st">"multiclock.clock2.trees"</span><span class="ot"> logEvery=</span><span class="st">"10"</span><span class="ot"> mode=</span><span class="st">"tree"</span><span class="kw">&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">&lt;log</span><span class="ot"> id=</span><span class="st">"TreeWithMetaDataLogger.t:26"</span><span class="ot"> spec=</span><span class="st">"beast.evolution.tree.TreeWithMetaDataLogger"</span><span class="ot"> branchratemodel=</span><span class="st">"@ExponentialRelaxedClock.c:261"</span><span class="ot"> tree=</span><span class="st">"@Tree.t:26"</span><span class="kw">/&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">&lt;/logger&gt;</span></span></code></pre></div>
<p>The clock name needs to reference the name (<code>id</code>) of one of the clock models set up in the analysis, which can be found earlier in the XML file.</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="get-rates-from-the-clock-tree-and-create-a-rate-table">1. Get rates from the clock tree and create a rate table<a class="anchor" aria-label="anchor" href="#get-rates-from-the-clock-tree-and-create-a-rate-table"></a>
</h3>
<p>Here we assume that a consensus or summary tree has been generated for each of the tree log files generated by the inference configured in step 0, for instance by using the software TreeAnnotator. First, import these summary clock trees using <code>treeio</code>’s function <code>read.beast()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Import all clock summary trees (.tre, .t, or .tree) produced by BEAST2 from your local directory</span></span>
<span></span>
<span><span class="va">tree_clock1</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="st">"tree_clock1.tre"</span><span class="op">)</span></span>
<span><span class="va">tree_clock2</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="st">"tree_clock2.tre"</span><span class="op">)</span></span>
<span><span class="co">#etc</span></span></code></pre></div>
<p>Below, we use the example BEAST2 clock trees from 3 morphological partitions and one molecular clock partition that accompany <code>EvoPhylo</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_clock1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Penguins_MCC_morpho_part1.t"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">tree_clock2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Penguins_MCC_morpho_part2.t"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">tree_clock3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Penguins_MCC_morpho_part3.t"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">tree_clock4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Penguins_MCC_dna.t"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">tree_clock1</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="va">tree_clock1</span><span class="op">)</span></span>
<span><span class="va">tree_clock2</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="va">tree_clock2</span><span class="op">)</span></span>
<span><span class="va">tree_clock3</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="va">tree_clock3</span><span class="op">)</span></span>
<span><span class="va">tree_clock4</span> <span class="op">&lt;-</span> <span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="va">tree_clock4</span><span class="op">)</span></span></code></pre></div>
<p>Subsequently, using <code><a href="../reference/get_clockrate_table_BEAST2.html">get_clockrate_table_BEAST2()</a></code>, users can extract mean or median rate values for each node in the summary tree. These mean or median rate values are calculated by TreeAnnotator taking into account all trees from the posterior sample. Please note that analyses must have reached the stationarity phase and independent runs converging for the summary statistics in each node to be meaningful summaries of the posterior sample.</p>
<p>The example shown here uses two different clocks, however the function supports any number of clocks which can all be passed as separate arguments.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get table of clock rates with summary stats for each node in </span></span>
<span><span class="co">## the tree for each relaxed clock partition (4 partitions in this dataset) </span></span>
<span><span class="va">RateTable_Medians_4p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clockrate_table_BEAST2.html">get_clockrate_table_BEAST2</a></span><span class="op">(</span><span class="va">tree_clock1</span>, <span class="va">tree_clock2</span>, <span class="va">tree_clock3</span>, <span class="va">tree_clock4</span>, summary <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span>
<span><span class="va">RateTable_Means_4p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clockrate_table_BEAST2.html">get_clockrate_table_BEAST2</a></span><span class="op">(</span><span class="va">tree_clock1</span>, <span class="va">tree_clock2</span>, <span class="va">tree_clock3</span>, <span class="va">tree_clock4</span>, summary <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="export-the-rate-table-and-plot-tree-with-node-values">2. Export the rate table and plot tree with node values<a class="anchor" aria-label="anchor" href="#export-the-rate-table-and-plot-tree-with-node-values"></a>
</h3>
<p>Once a rate table has been obtained from <a href="https://www.beast2.org/" class="external-link">BEAST2</a> files, it is necessary to export it. This is a necessary step to subsequently open the rate table spreadsheet locally (e.g., using Microsoft Office Excel) and customize the table with clade names associated with with each node in the tree for downstream analyses. Note that the root node may include “NA” for rate value, so it must be removed from the rate table.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Export the rate tables </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">RateTable_Means_4p</span>, file <span class="op">=</span> <span class="st">"RateTable_Means_4p.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">RateTable_Medians_4p</span>, file <span class="op">=</span> <span class="st">"RateTable_Medians_4p.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plot-tree-node-labels-to-customize-clade-names">Plot tree node labels to customize clade names<a class="anchor" aria-label="anchor" href="#plot-tree-node-labels-to-customize-clade-names"></a>
</h2>
<p>To visualize the node values in the tree, you can use <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree()</a></code>. This can be done on any of the imported trees, as all BEAST2 Summary trees should have the same topology and divergence times, differing only on rate parameters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot tree node labels</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.amazon.com/Integration-Manipulation-Visualization-Phylogenetic-Computational-ebook/dp/B0B5NLZR1Z/" class="external-link">ggtree</a></span><span class="op">)</span></span>
<span><span class="va">tree_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree</a></span><span class="op">(</span><span class="va">tree_clock1</span>, branch.length <span class="op">=</span> <span class="st">"none"</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html" class="external-link">geom_tiplab</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, linesize <span class="op">=</span> <span class="fl">0.01</span>, color <span class="op">=</span> <span class="st">"black"</span>, offset <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">node</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="va">tree_nodes</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Save your plot to your working directory as a PDF</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"Tree_nodes.pdf"</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<div class="section level3">
<h3 id="import-rate-table-with-custom-clade-memberships">3. Import rate table with custom clade memberships<a class="anchor" aria-label="anchor" href="#import-rate-table-with-custom-clade-memberships"></a>
</h3>
<p>A new “clade” column has been added to the rates table. Below, we use the rate table with clade membership <code>RateTable_Means_4p_Clades</code> that accompanies <code>EvoPhylo</code> (clade names in this example are for demonstration purposes only).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Import rate table with clade membership (new "clade" column added) </span></span>
<span><span class="co">## from your local directory</span></span>
<span><span class="va">RateTable_Medians_Clades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"RateTable_Medians_Clades.csv"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">RateTable_Medians_Clades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">##               clade nodes     rates1     rates2     rates3     rates4</span></span>
<span><span class="co">## 1 EarlyStemPenguins     1 0.01059049 0.01142373 0.04521063 0.03214791</span></span>
<span><span class="co">## 2 EarlyStemPenguins     2 0.01127067 0.01117188 0.04558499 0.03297338</span></span>
<span><span class="co">## 3 EarlyStemPenguins    58 0.01252320 0.01143236 0.04487146 0.03119615</span></span>
<span><span class="co">## 4     CrownPenguins     3 0.01493279 0.01009941 0.04626338 0.04521892</span></span>
<span><span class="co">## 5     CrownPenguins     4 0.01050220 0.01008585 0.04537996 0.03908424</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="get-summary-stats-for-each-cladeclock-partition">4. Get summary stats for each clade/clock partition<a class="anchor" aria-label="anchor" href="#get-summary-stats-for-each-cladeclock-partition"></a>
</h3>
<p>Obtain summary statistics table and plots for each clade by clock partition using <code><a href="../reference/clockrate_summary.html">clockrate_summary()</a></code>. Supplying a file path to <code>file</code> save the output to that file.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get summary statistics table for each clade by clock </span></span>
<span><span class="fu"><a href="../reference/clockrate_summary.html">clockrate_summary</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>,</span>
<span>                  file <span class="op">=</span> <span class="st">"Sum_RateTable_Medians_4p.csv"</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 15px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Rate table summary statistics
</caption>
<thead><tr>
<th style="text-align:left;">
clade
</th>
<th style="text-align:left;">
clock
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
Q1
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
Q3
</th>
<th style="text-align:right;">
max
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
CrownPenguins
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.024
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.035
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.081
</td>
</tr>
<tr>
<td style="text-align:left;">
CrownPenguins
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.013
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.013
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.014
</td>
</tr>
<tr>
<td style="text-align:left;">
CrownPenguins
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.038
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.062
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.046
</td>
<td style="text-align:right;">
0.052
</td>
</tr>
<tr>
<td style="text-align:left;">
CrownPenguins
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.058
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0.034
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.047
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.036
</td>
</tr>
</tbody>
</table>
<p> </p>
</div>
<div class="section level3">
<h3 id="plot-rates-by-clock-partition-and-clade">5. Plot rates by clock partition and clade<a class="anchor" aria-label="anchor" href="#plot-rates-by-clock-partition-and-clade"></a>
</h3>
<p>Plot distributions of rates by clock partition and clade with <code><a href="../reference/clockrate_dens_plot.html">clockrate_dens_plot()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Overlapping plots</span></span>
<span><span class="fu"><a href="../reference/clockrate_dens_plot.html">clockrate_dens_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, stack <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                    nrow <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Sometimes using stacked plots provides a better visualization as it avoids overlapping distributions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Stacked plots</span></span>
<span><span class="fu"><a href="../reference/clockrate_dens_plot.html">clockrate_dens_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    nrow <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>It is also possible to append extra layers using <code>ggplot2</code> function, such as for changing the color scale. Below, we change the color scale to be the Viridis scale.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Stacked plots with viridis color scale</span></span>
<span><span class="fu"><a href="../reference/clockrate_dens_plot.html">clockrate_dens_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, stack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    nrow <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;"></p>
<p> </p>
</div>
<div class="section level3">
<h3 id="rate-linear-models">6. Rate linear models<a class="anchor" aria-label="anchor" href="#rate-linear-models"></a>
</h3>
<p>We can also plot linear model regressions between rates from two or more clocks with <code><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot regressions of rates from multiple clocks</span></span>
<span><span class="co">#Morpho-morpho rates</span></span>
<span><span class="va">p1</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">1</span>, clock_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p2</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">1</span>, clock_y <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p3</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">2</span>, clock_y <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Morpho-Mol rates</span></span>
<span><span class="va">p4</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">1</span>, clock_y <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">p5</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">2</span>, clock_y <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">p6</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/clockrate_reg_plot.html">clockrate_reg_plot</a></span><span class="op">(</span><span class="va">RateTable_Medians_Clades</span>, clock_x <span class="op">=</span> <span class="fl">3</span>, clock_y <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co">#for combining plots</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Save your plot to your working directory as a PDF</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"Plot_regs.pdf"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p> <br>
 <br>
 </p>
</div>
</div>
<div class="section level2">
<h2 id="selection-mode">Selection Mode<a class="anchor" aria-label="anchor" href="#selection-mode"></a>
</h2>
<p>In this section, we will use evolutionary rate based inference of selection mode, as first introduced by <span class="citation">Baker et al. (<a href="#ref-baker2016" role="doc-biblioref">2016</a>)</span> for continuous traits, and later adapted to clock-based rates by <span class="citation">Simões and Pierce (<a href="#ref-sim%C3%B5es2021" role="doc-biblioref">2021</a>)</span>.</p>
<p>Although the dataset used in the example here includes both morphological and molecular partitions, we will focus the selection mode inference using morphological partitions only. There are multiple available methods to infer the strength of selection using molecular data (e.g., dn/ds ratio) that are better suited to the intrinsic properties of molecular data, or which take into account additional variables available for extant taxa (generation times), and we refer users to those approaches.</p>
<p> </p>
<div class="section level3">
<h3 id="import-posterior-log-file">1. Import posterior log file<a class="anchor" aria-label="anchor" href="#import-posterior-log-file"></a>
</h3>
<p>The combined posterior log file from <a href="https://www.beast2.org/beagle-beast-2-in-cluster/index.html" class="external-link">BEAST2</a> is outputted by <strong>LogCombiner</strong> from their software package. Our own function to combined log files <code>combine_log</code> is intended to work with <a href="https://nbisweden.github.io/MrBayes/" class="external-link">Mr. Bayes</a> posterior files only.</p>
<p>When using more two or more clock partitions, posterior log files from BEAST2 will have the mean evolutionary rates for each partition labeled as “rate<filename><partitionnumber>.mean”. To be read and analyzed by <code>Evophylo</code>, users must ensure that all clock partitions that wish to be analyzed should include the word “part” just before the partition number in this label, as outputted by the <code>Evophylo</code>’s function <code>write_partitioned_alignments</code>. So, this label should read “rate<filename>part<partitionnumber>.mean”. In our example provided here, with filename “KairukuEA2015”, the first morphological partition was exported with <code>write_partitioned_alignments</code> as a Nexus file labeled “KairukuEA2015_Morpho_3p_part1”, and so the mean evolutionary rates for the first partition is labeled “rate.KairukuEA2015_Morpho_3p_part1.mean”.</partitionnumber></filename></partitionnumber></filename></p>
<p>Below, we use the posterior dataset “Penguins_log.log” that accompanies <code>EvoPhylo</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Penguins_log.log"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">posterior</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Show first 10 lines of combined log file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">posterior</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>###2. Check background rates distribution and if they need transformation</p>
<p>The output includes histograms showing the data distribution before and after data transformation for comparisons.</p>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-18-1.png" width="90%" style="display: block; margin: auto;"><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-18-2.png" width="90%" style="display: block; margin: auto;"><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-18-3.png" width="90%" style="display: block; margin: auto;"></p>
<p> </p>
</div>
<div class="section level3">
<h3 id="plot-selection-gradient-on-the-summary-tree">3. Plot selection gradient on the summary tree<a class="anchor" aria-label="anchor" href="#plot-selection-gradient-on-the-summary-tree"></a>
</h3>
<p>Using different thresholds, Identify the selection mode across branches in the tree for each clock partition with <code><a href="../reference/plot_treerates_sgn.html">plot_treerates_sgn()</a></code>.</p>
<p>Users must indicate the type of output file (between <a href="https://nbisweden.github.io/MrBayes/" class="external-link">Mr. Bayes</a> and <a href="https://www.beast2.org/" class="external-link">BEAST2</a>) and whether they would like to log transform the background rate to meet assumptions of normally distributed data, based on the results obtained from <code>plot_back_rates</code>. Users should also indicate in “clock” the number of the clock partition they would like to plot rates from and the desired significance threshold to interpret branch rates (we recommend number of standard deviations around the mean of background rates).Finally, a series of arguments enable users to customize the geological timescale to add to the tree.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot tree using various thresholds for clock partition 1</span></span>
<span><span class="va">A1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/plot_treerates_sgn.html">plot_treerates_sgn</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"BEAST2"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>,                         <span class="co">#Indicates software name output and type of transformation</span></span>
<span>  <span class="va">tree_clock1</span>, <span class="va">posterior</span>,                                   <span class="co">#Calls tree for clock partition 1 and posterior log file</span></span>
<span>  clock <span class="op">=</span> <span class="fl">1</span>,                                                <span class="co">#Use background rates for clock partition 1</span></span>
<span>  threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1 SD"</span>, <span class="st">"3 SD"</span><span class="op">)</span>,                            <span class="co">#sets threshold for selection mode</span></span>
<span>  branch_size <span class="op">=</span> <span class="fl">1.5</span>, tip_size <span class="op">=</span> <span class="fl">3</span>,                          <span class="co">#sets size for tree elements</span></span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">70</span>, <span class="fl">30</span><span class="op">)</span>, nbreaks <span class="op">=</span> <span class="fl">8</span>, geo_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>    <span class="co">#sets limits and breaks for geoscale</span></span>
<span><span class="va">A1</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Plot tree using various thresholds for the other clock partitions and combine them.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot tree using various thresholds for other clock partition and combine them</span></span>
<span><span class="va">A2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/plot_treerates_sgn.html">plot_treerates_sgn</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"BEAST2"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>,                         <span class="co">#Indicates software name output and type of transformation</span></span>
<span>  <span class="va">tree_clock2</span>, <span class="va">posterior</span>,                                   <span class="co">#Calls tree for clock partition 2 and posterior log file</span></span>
<span>  clock <span class="op">=</span> <span class="fl">2</span>,                                                <span class="co">#Use background rates for clock partition 3</span></span>
<span>  threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1 SD"</span>, <span class="st">"3 SD"</span><span class="op">)</span>,                            <span class="co">#sets threshold for selection mode</span></span>
<span>  branch_size <span class="op">=</span> <span class="fl">1.5</span>, tip_size <span class="op">=</span> <span class="fl">3</span>,                          <span class="co">#sets size for tree elements</span></span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">70</span>, <span class="fl">30</span><span class="op">)</span>, nbreaks <span class="op">=</span> <span class="fl">8</span>, geo_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>    <span class="co">#sets limits and breaks for geoscale</span></span>
<span></span>
<span></span>
<span><span class="va">A3</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/plot_treerates_sgn.html">plot_treerates_sgn</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"BEAST2"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>,                         <span class="co">#Indicates software name output and type of transformation</span></span>
<span>  <span class="va">tree_clock3</span>, <span class="va">posterior</span>,                                   <span class="co">#Calls tree for clock partition 3 and posterior log file</span></span>
<span>  clock <span class="op">=</span> <span class="fl">3</span>,                                                <span class="co">#Use background rates for clock partition 3</span></span>
<span>  threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1 SD"</span>, <span class="st">"3 SD"</span><span class="op">)</span>,                            <span class="co">#sets threshold for selection mode</span></span>
<span>  branch_size <span class="op">=</span> <span class="fl">1.5</span>, tip_size <span class="op">=</span> <span class="fl">3</span>,                          <span class="co">#sets size for tree elements</span></span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">70</span>, <span class="fl">30</span><span class="op">)</span>, nbreaks <span class="op">=</span> <span class="fl">8</span>, geo_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>    <span class="co">#sets limits and breaks for geoscale</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">A1</span> <span class="op">+</span> <span class="va">A2</span> <span class="op">+</span> <span class="va">A3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="rates-selection_BEAST2_files/figure-html/unnamed-chunk-20-1.png" width="100%"></p>
<pre class="eval"><code><span><span class="co">## Save your plot to your working directory as a PDF</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"Tree_Sel_Morpho_3p.pdf"</span>, width <span class="op">=</span> <span class="fl">18</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre>
<p> </p>
</div>
<div class="section level3">
<h3 id="pairwise-t-tests-of-rate-values-among-clades">4. Pairwise t-tests of rate values among clades<a class="anchor" aria-label="anchor" href="#pairwise-t-tests-of-rate-values-among-clades"></a>
</h3>
<p>The function <code><a href="../reference/get_pwt_rates_BEAST2.html">get_pwt_rates_BEAST2()</a></code> complements the functionality of <code>plot_treerates_sgn</code> by producing a table of pairwise t-tests for differences between the mean background rate in the posterior and the absolute rate for each summary tree branches Should be used only for normally distributed data in which a CI=0.95 is considered a good threshold. In many cases, however, using multiple standard deviations as outputted using <code>plot_treerates_sgn</code> provides a more robust test of whether branch rates are significantly different from background rates.</p>
<p>4.1. Import rate table with clade membership (new “clade” column added) from your local directory with “mean” values</p>
<p>Below, we use the rate table with clade membership “RateTable_Means_Clades.csv” that accompanies <code>EvoPhylo</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Import rate table with clade membership (new "clade" column added) </span></span>
<span><span class="co">## from your local directory with "mean" values</span></span>
<span><span class="va">RateTable_Means_Clades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"RateTable_Means_Clades.csv"</span>, package <span class="op">=</span> <span class="st">"EvoPhylo"</span><span class="op">)</span></span>
<span><span class="va">RateTable_Means_Clades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">RateTable_Means_Clades</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">RateTable_Means_Clades</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">##               clade nodes     rates1     rates2     rates3     rates4</span></span>
<span><span class="co">## 1 EarlyStemPenguins     1 0.01680336 0.01217294 0.04894430 0.03657966</span></span>
<span><span class="co">## 2 EarlyStemPenguins     2 0.01782966 0.01181350 0.04985747 0.03746188</span></span>
<span><span class="co">## 3 EarlyStemPenguins    58 0.02404947 0.01263853 0.04995735 0.03741211</span></span>
<span><span class="co">## 4     CrownPenguins     3 0.01913400 0.01017825 0.05145375 0.04892464</span></span>
<span><span class="co">## 5     CrownPenguins     4 0.01319288 0.01016964 0.04996688 0.04325669</span></span></code></pre></div>
<p>4.2. Get and export table of pairwise t-tests</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get table of pairwise t-tests for difference between the posterior </span></span>
<span><span class="co">## mean and the rate for each tree node</span></span>
<span><span class="va">RateSign_Tests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwt_rates_BEAST2.html">get_pwt_rates_BEAST2</a></span><span class="op">(</span><span class="va">RateTable_Means_Clades</span>, <span class="va">posterior</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 15px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Combined log file
</caption>
<thead><tr>
<th style="text-align:left;">
clade
</th>
<th style="text-align:right;">
node
</th>
<th style="text-align:left;">
clock
</th>
<th style="text-align:right;">
background.rate.mean
</th>
<th style="text-align:right;">
absolute.rate.mean
</th>
<th style="text-align:right;">
relative.rate.mean
</th>
<th style="text-align:right;">
p.value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0156937
</td>
<td style="text-align:right;">
0.6015154
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:right;">
65
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0215020
</td>
<td style="text-align:right;">
0.8241390
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0153367
</td>
<td style="text-align:right;">
0.5878329
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
LateStemPenguins
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0450708
</td>
<td style="text-align:right;">
1.7274962
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0175102
</td>
<td style="text-align:right;">
0.6711403
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0161433
</td>
<td style="text-align:right;">
0.6187486
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0189790
</td>
<td style="text-align:right;">
0.7274382
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0178498
</td>
<td style="text-align:right;">
0.6841549
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
98
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0130211
</td>
<td style="text-align:right;">
0.4990813
</td>
<td style="text-align:right;">
0e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
EarlyStemPenguins
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0260902
</td>
<td style="text-align:right;">
0.0223161
</td>
<td style="text-align:right;">
0.8553429
</td>
<td style="text-align:right;">
5e-07
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Export the table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">RateSign_Tests</span>, file <span class="op">=</span> <span class="st">"RateSign_Tests.csv"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-baker2016">
<p>Baker, Joanna, Andrew Meade, Mark Pagel, and Chris Venditti. 2016. “Positive Phenotypic Selection Inferred from Phylogenies.” <em>Biological Journal of the Linnean Society</em> 118 (1): 95–115.</p>
</div>
<div id="ref-simões2021">
<p>Simões, Tiago R., and Stephanie E. Pierce. 2021. “Sustained High Rates of Morphological Evolution During the Rise of Tetrapods.” <em>Nature Ecology &amp; Evolution</em> 5 (10): 1403–14. <a href="https://doi.org/10.1038/s41559-021-01532-x" class="external-link">https://doi.org/10.1038/s41559-021-01532-x</a>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tiago Simoes, Noah Greifer, Joelle Barido-Sottani, Stephanie Pierce.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
