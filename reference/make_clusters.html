<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Determines cluster (partition) membership for phylogenetic morphological characters from the supplied Gower distance matrix and requested number of clusters using partitioning around medoids (PAM, or K-medoids). For further and independently testing the quality of the chosen partitioning scheme, users may also poduce graphic clustering (tSNEs), coloring data points according to PAM clusters, to verify PAM clustering results."><title>Estimate and plot character partitions — make_clusters • EvoPhylo</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate and plot character partitions — make_clusters"><meta property="og:description" content="Determines cluster (partition) membership for phylogenetic morphological characters from the supplied Gower distance matrix and requested number of clusters using partitioning around medoids (PAM, or K-medoids). For further and independently testing the quality of the chosen partitioning scheme, users may also poduce graphic clustering (tSNEs), coloring data points according to PAM clusters, to verify PAM clustering results."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EvoPhylo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_treatment.html">Theoretical background</a>
    <a class="dropdown-item" href="../articles/char-part.html">Character Partitioning</a>
    <a class="dropdown-item" href="../articles/rates-selection_MrBayes.html">Evolutionary Rates &amp; Selection Mode (Mr.Bayes)</a>
    <a class="dropdown-item" href="../articles/rates-selection_BEAST2.html">Evolutionary Rates &amp; Selection Mode (BEAST2)</a>
    <a class="dropdown-item" href="../articles/fbd-params.html">Analyzing FBD Parameters</a>
    <a class="dropdown-item" href="../articles/offset_handling.html">Analyzing Trees With Offsets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tiago-simoes/EvoPhylo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate and plot character partitions</h1>
      
      <div class="d-none name"><code>make_clusters.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Determines cluster (partition) membership for phylogenetic morphological characters from the supplied Gower distance matrix and requested number of clusters using partitioning around medoids (PAM, or K-medoids). For further and independently testing the quality of the chosen partitioning scheme, users may also poduce graphic clustering (tSNEs), coloring data points according to PAM clusters, to verify PAM clustering results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_clusters</span><span class="op">(</span><span class="va">dist_mat</span>, <span class="va">k</span>, tsne <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              tsne_dim <span class="op">=</span> <span class="fl">2</span>, tsne_theta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>              <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for cluster_df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, seed <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dist_mat</dt>
<dd><p>A Gower distance matrix, the output of a call to <code><a href="get_gower_dist.html">get_gower_dist</a></code>.</p></dd>

  <dt>k</dt>
<dd><p>The desired number of clusters (or character partitions), the output from <code><a href="get_sil_widths.html">get_sil_widths</a></code>.</p></dd>

  <dt>tsne</dt>
<dd><p>Whether to perform Barnes-Hut t-distributed stochastic neighbor embedding (tSNE) to produce a multi-dimensional representation of the distance matrix using <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code>. The number of dimensions is controlled by the <code>tsne_dim</code> argument. See Details. Default is <code>FALSE</code>.</p></dd>

  <dt>tsne_dim</dt>
<dd><p>When <code>tsne = TRUE</code>, the number of dimensions for the tSNE multidimensional scaling plots. This is passed to the <code>dims</code> argument of <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code>. Default is 2.</p></dd>

  <dt>tsne_theta</dt>
<dd><p>When <code>tsne = TRUE</code>, a parameter controlling the speed/accuracy trade-off (increase for faster but less accurate results). This is passed to the <code>theta</code> argument of <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code>. Default is 0 for exact tSNE.</p></dd>

  <dt>...</dt>
<dd><p>For <code>make_clusters()</code>, other arguments passed to <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code> when <code>tsne = TRUE</code>.</p>
<p>For <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, when plotting a <code>cluster_df</code> object, other arguments passed to <code><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">ggrepel::geom_text_repel</a></code> to control display of the observation labels.</p></dd>

  <dt>x</dt>
<dd><p>For <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, a <code>cluster_df</code> object; the output of a call to <code>make_clusters()</code>.</p></dd>

  <dt>seed</dt>
<dd><p>For <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, the seed used to control the placement of the labels and the jittering of the points. Jittering only occurs when <code>tsne = FALSE</code> in the call to <code>make_clusters()</code>. Using a non-<code>NA</code> seed ensure replicability across uses.</p></dd>

  <dt>nrow</dt>
<dd><p>For <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, when <code>tsne = TRUE</code> in the call to <code>make_clusters()</code> and <code>tsne_dim</code> is greater than 2, the number of rows used to display the resulting 2-dimensional plots. Default is 1 for side-by-side plots.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>make_clusters</code> calls <code><a href="https://rdrr.io/pkg/cluster/man/pam.html" class="external-link">cluster::pam</a></code> on the supplied Gower distance matrix with the specified number of clusters to determine cluster membership for each character. PAM is analogous to K-means, but it has its clusters centered around medoids instead of centered around centroids, which are less prone to the impact from outliers and heterogeneous cluster sizes. PAM also has the advantage over k-means of utilizing Gower distance matrices instead of Euclidean distance matrices only.</p>
<p>When <code>tsne = TRUE</code>, a Barnes-Hut t-distributed stochastic neighbor embedding is used to compute a multi-dimensional embedding of the distance matrix, coloring data points according to the PAM-defined clusters, as estimated by the function <code>make_clusters</code>. This graphic clustering allows users to independently test the quality of the chosen partitioning scheme from PAM, and can help in visualizing the resulting clusters. <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code> is used to do this. The resulting dimensions will be included in the output; see Value below.</p>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> plots all morphological characters in a scatterplot with points colored based on cluster membership. When <code>tsne = TRUE</code> in the call to <code>make_clusters()</code>, the x- and y-axes will correspond to requested tSNE dimensions. With more than 2 dimensions, several plots will be produced, one for each pair of tSNE dimensions. These are displayed together using <code><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">patchwork::plot_layout</a></code>. When <code>tsne = FALSE</code>, the points will be arrange horizontally by cluster membership and randomly placed vertically.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame, inheriting from class <code>"cluster_df"</code>, with a row for each character with its number (<code>character_number</code>) and cluster membership (<code>cluster</code>). When <code>tsne = TRUE</code>, additional columns  will be included, one for each requested tSNE dimension, labeled <code>tSNE_Dim1</code>, <code>tSNE_Dim2</code>, etc., containing the values on the dimensions computed using <code>Rtsne()</code>.</p>


<p>The <code>pam</code> fit resulting from <code><a href="https://rdrr.io/pkg/cluster/man/pam.html" class="external-link">cluster::pam</a></code> is returned in the <code>"pam.fit"</code> attribute of the outut object.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>When using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on a <code>cluster_df</code> object, warnings may appear from <code>ggrepel</code> saying something along the lines of "unlabeled data points (too many overlaps). Consider increasing max.overlaps". See <code><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">ggrepel::geom_text_repel</a></code> for details; the <code>max.overlaps</code> argument can be supplied to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to increase the maximum number of element overlap in the plot. Alternatively, users can increase the size of the plot when exporting it, as it will increase the plot area and reduce the number of elements overlap. This warning can generally be ignored, though.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="../articles/char-part.html">vignette("char-part")</a></code> for the use of this function as part of an analysis pipeline.</p>
<p><code><a href="get_gower_dist.html">get_gower_dist</a></code>, <code><a href="get_sil_widths.html">get_sil_widths</a></code>, <code><a href="cluster_to_nexus.html">cluster_to_nexus</a></code></p>
<p><code><a href="https://rdrr.io/pkg/cluster/man/pam.html" class="external-link">cluster::pam</a></code>, <code><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne::Rtsne</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># See vignette("char-part") for how to use this</span></span></span>
<span class="r-in"><span><span class="co"># function as part of an analysis pipeline</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"characters"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reading example file as categorical data</span></span></span>
<span class="r-in"><span><span class="va">Dmatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_gower_dist.html">get_gower_dist</a></span><span class="op">(</span><span class="va">characters</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sil_widths</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_sil_widths.html">get_sil_widths</a></span><span class="op">(</span><span class="va">Dmatrix</span>, max.k <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sil_widths</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   k sil_width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 0.2340255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 3 0.2626128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 4 0.1863738</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 5 0.1243595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 6 0.1205568</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 7 0.1102649</span>
<span class="r-in"><span><span class="co"># 3 clusters yields the highest silhouette width</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create clusters with PAM under k=3 partitions</span></span></span>
<span class="r-in"><span><span class="va">cluster_df</span> <span class="op">&lt;-</span> <span class="fu">make_clusters</span><span class="op">(</span><span class="va">Dmatrix</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple plot of clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cluster_df</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>ggrepel: 5 unlabeled data points (too many overlaps). Consider increasing max.overlaps</span>
<span class="r-plt img"><img src="make_clusters-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create clusters with PAM under k=3 partitions and perform</span></span></span>
<span class="r-in"><span><span class="co"># tSNE (3 dimensions; default is 2)</span></span></span>
<span class="r-in"><span><span class="va">cluster_df_tsne</span> <span class="op">&lt;-</span> <span class="fu">make_clusters</span><span class="op">(</span><span class="va">Dmatrix</span>, k <span class="op">=</span> <span class="fl">3</span>, tsne <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                                 tsne_dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot clusters, plots divided into 2 rows, and increasing</span></span></span>
<span class="r-in"><span><span class="co"># overlap of text labels (default = 10)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cluster_df_tsne</span>, nrow <span class="op">=</span> <span class="fl">2</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>ggrepel: 1 unlabeled data points (too many overlaps). Consider increasing max.overlaps</span>
<span class="r-plt img"><img src="make_clusters-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Tiago Simoes, Noah Greifer, Joelle Barido-Sottani, Stephanie Pierce.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

